<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Horas - Fortes Engenharia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .color-primary {
            background-color: #003366;
        }
        .text-accent {
            color: #00b894;
        }
        .bg-accent {
            background-color: #00b894;
        }
        .sidebar-item:hover {
            background-color: rgba(0, 51, 102, 0.1);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .progress-bar-bg {
            background-color: #e5e7eb;
        }
        .progress-bar-fill {
            background-color: #3b82f6;
        }
    </style>
</head>
<body class="flex h-screen">
    <aside id="sidebar" class="w-64 bg-white flex flex-col justify-between py-6 px-4 border-r border-gray-200">
        <div>
            <div class="mb-8 p-2">
                <img src="/IMG/logo.png" alt="Logo Fortes Engenharia" class="w-full h-auto">
            </div>
            <nav>
                <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-white font-semibold color-primary transition duration-150">
                    <img src="/IMG/Relogio.png" alt="Relógio" class="w-5 h-5 mr-3 invert brightness-0">
                    Minhas Horas
                </a>
            </nav>
        </div>
        <div>
            <div class="flex items-center p-2 mb-4">
                <img src="/IMG/Usuario.png" alt="Usuário" class="w-10 h-10 rounded-full bg-purple-200 p-1 mr-3">
                <div>
                    <p class="font-semibold text-gray-800">Thales Chequer</p>
                    <p class="text-sm text-gray-500">Técnico</p>
                </div>
            </div>
            <div class="space-y-2 mb-4">
                <button onclick="showCustomModal('Configurações', 'Aqui você pode ajustar as preferências do seu perfil.')" class="w-full flex items-center p-3 rounded-lg bg-gray-100 text-gray-800 hover:bg-gray-200 transition duration-150">
                    <img src="/IMG/Engrenagem.png" alt="Configurações" class="w-5 h-5 mr-3">
                    Configuração
                </button>
                <button onclick="showCustomModal('Ajuda', 'Entre em contato com o suporte para resolver suas dúvidas.')" class="w-full flex items-center p-3 rounded-lg bg-gray-100 text-gray-800 hover:bg-gray-200 transition duration-150">
                    <img src="/IMG/Interrogação.png" alt="Ajuda" class="w-5 h-5 mr-3">
                    Ajuda
                </button>
                <button onclick="showCustomModal('Sair', 'Você será desconectado do sistema.')" class="w-full flex items-center p-3 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition duration-150">
                    <img src="/IMG/Saida.png" alt="Sair" class="w-5 h-5 mr-3">
                    Sair
                </button>
            </div>
            <div class="text-xs text-gray-400 mt-4 px-2">
                <p>Versão 1.0.0</p>
                <p>© 2025 Fortes Engenharia</p>
            </div>
        </div>
    </aside>
    <main class="flex-1 overflow-y-auto p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Olá, Thales Chequer</h1>
            <p class="text-gray-500">Visualize e confirme suas horas extras trabalhadas</p>
        </header>
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-white p-6 rounded-xl card-shadow">
                <p class="text-gray-500 font-medium mb-1">Total de Horas</p>
                <p id="totalHorasDisplay" class="text-3xl font-bold text-gray-900">0h</p>
            </div>
            <div class="bg-white p-6 rounded-xl card-shadow">
                <p class="text-gray-500 font-medium mb-1">Pedidos Completos</p>
                <p id="pedidosCompletosDisplay" class="text-3xl font-bold text-green-600">0</p>
            </div>
            <div class="bg-white p-6 rounded-xl card-shadow">
                <p class="text-gray-500 font-medium mb-1">Pendentes</p>
                <p id="pedidosPendentesDisplay" class="text-3xl font-bold text-yellow-600">0</p>
            </div>
        </section>
        <section class="bg-white p-6 rounded-xl card-shadow mb-10">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Horas por Obra</h2>
            <div id="horasPorObraContainer" class="space-y-4">
            </div>
        </section>
        <section class="bg-white p-6 rounded-xl card-shadow mb-10 flex items-center space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414A1 1 0 0012 14.586V21a1 1 0 01-2 0v-6.414a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
            <select class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                <option>Todas as obras</option>
                <option>Obra Vitória Marina</option>
                <option>Obra Ponte Norte</option>
                <option>Obra Centro Logístico</option>
            </select>
            <input type="date" placeholder="Data Início" class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            <input type="date" placeholder="Data Fim" class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
        </section>
        <section class="bg-white p-6 rounded-xl card-shadow">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Registros Detalhados</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Obra</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Horário</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Horas</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ação</th>
                        </tr>
                    </thead>
                    <tbody id="registrosTabelaBody" class="bg-white divide-y divide-gray-200">
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    <div id="customModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-xl w-full max-w-sm card-shadow">
            <h3 id="modalTitle" class="text-xl font-semibold text-gray-800 mb-4">Título</h3>
            <p id="modalMessage" class="text-gray-600 mb-6">Mensagem</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeCustomModal()" class="px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition">Fechar</button>
                <button id="modalActionBtn" class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition hidden">Confirmar</button>
            </div>
        </div>
    </div>
    <script>
        const registros = [
            {
                data: '14/11/2025',
                obra: 'Obra Vitória Marina',
                sigla: 'VM-2025',
                entrada: '17:00',
                saida: '19:00',
                totalHoras: 2,
                status: 'Confirmada'
            },
            {
                data: '09/11/2025',
                obra: 'Obra Vitória Marina',
                sigla: 'VM-2025',
                entrada: '18:00',
                saida: '20:00',
                totalHoras: 2,
                status: 'Confirmada'
            },
            {
                data: '07/11/2025',
                obra: 'Obra Vitória Marina',
                sigla: 'VM-2025',
                entrada: '17:30',
                saida: '19:30',
                totalHoras: 2,
                status: 'Pendente'
            },
            {
                data: '05/11/2025',
                obra: 'Obra Ponte Norte',
                sigla: 'PN-2025',
                entrada: '08:00',
                saida: '12:00',
                totalHoras: 4,
                status: 'Pendente'
            },
            {
                data: '01/11/2025',
                obra: 'Obra Centro Logístico',
                sigla: 'CL-2025',
                entrada: '14:00',
                saida: '18:00',
                totalHoras: 4,
                status: 'Confirmada'
            },
        ];
        function calcularMetricas(listaRegistros) {
            let totalHoras = 0;
            let pedidosCompletos = 0;
            let pedidosPendentes = 0;

            listaRegistros.forEach(registro => {
                totalHoras += registro.totalHoras;

                if (registro.status === 'Confirmada') {
                    pedidosCompletos++;
                } else if (registro.status === 'Pendente') {
                    pedidosPendentes++;
                }
            });

            return {
                totalHoras: totalHoras,
                pedidosCompletos: pedidosCompletos,
                pedidosPendentes: pedidosPendentes
            };
        }
        function validarPresenca(registro, index) {
            const obraLocalizacao = 'Coordenadas Mock (Lat/Lng da Obra)';
            const tecnicoLocalizacao = 'Coordenadas Mock (Lat/Lng do Técnico)'; 

            const validacaoBemSucedida = Math.random() > 0.3; 

            const confirmAction = () => {
                if (validacaoBemSucedida) {

                    registros[index].status = 'Confirmada';
                    showCustomModal('Sucesso!', `Presença confirmada para a obra ${registro.obra} em ${registro.data}.`, false);
                } else {
                    showCustomModal('Falha na Validação', `Não foi possível confirmar a presença na obra ${registro.obra}. Tente novamente mais tarde ou contate o suporte.`, false);
                }
                renderizarDashboard();
            };

            showCustomModal(
                'Confirmação de Presença',
                `Deseja confirmar sua presença na obra "${registro.obra}" no dia ${registro.data}? A validação de geolocalização será realizada.`,
                true,
                confirmAction
            );
        }

        function renderizarResumo(metricas) {
            const totalHoras = metricas.totalHoras;
            const pedidosCompletos = metricas.pedidosCompletos;
            const pedidosPendentes = metricas.pedidosPendentes;

            document.getElementById('totalHorasDisplay').textContent = `${totalHoras}h`;
            document.getElementById('pedidosCompletosDisplay').textContent = pedidosCompletos.toString();
            document.getElementById('pedidosPendentesDisplay').textContent = pedidosPendentes.toString();
        }

        function renderizarRegistros(listaRegistros) {
            const tbody = document.getElementById('registrosTabelaBody');
            tbody.innerHTML = '';

            listaRegistros.forEach((registro, index) => {
                const isPendente = registro.status === 'Pendente';
                const statusClass = isPendente ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';

                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${registro.data}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${registro.obra}<br><span class="text-xs text-gray-400">${registro.sigla}</span></td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${registro.entrada} - ${registro.saida}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${registro.totalHoras}h</td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${registro.status}
                        </span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium">
                        ${isPendente ?
                            `<button onclick="validarPresenca(registros[${index}], ${index})" class="px-3 py-1 text-sm font-medium rounded-lg text-blue-600 border border-blue-600 hover:bg-blue-50 transition">Confirmar presença</button>` :
                            '<span class="text-gray-400">N/A</span>'
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        function renderizarHorasPorObra(listaRegistros, totalHorasGeral) {
            const container = document.getElementById('horasPorObraContainer');
            container.innerHTML = '';

            const horasPorObra = listaRegistros.reduce((acc, registro) => {
                acc[registro.obra] = (acc[registro.obra] || 0) + registro.totalHoras;
                return acc;
            }, {});
            const maxHorasVisual = 6;
            Object.keys(horasPorObra).forEach(obra => {
                const horas = horasPorObra[obra];

                const percentage = Math.min((horas / maxHorasVisual) * 100, 100);

                const div = document.createElement('div');
                div.className = 'mb-3';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <p class="text-sm font-medium text-gray-700">${obra}</p>
                        <p class="text-sm font-semibold text-gray-900">${horas}h</p>
                    </div>
                    <div class="progress-bar-bg h-2 rounded-full overflow-hidden">
                        <div class="progress-bar-fill h-full rounded-full" style="width: ${percentage}%;"></div>
                    </div>
                `;
                container.appendChild(div);
            });
            const obrasMock = ['Obra Ponte Norte', 'Obra Centro Logístico'];
            obrasMock.forEach(obra => {
                if (!horasPorObra[obra]) {
                    const div = document.createElement('div');
                    div.className = 'mb-3';
                    div.innerHTML = `
                        <div class="flex justify-between items-center mb-1">
                            <p class="text-sm font-medium text-gray-700">${obra}</p>
                            <p class="text-sm font-semibold text-gray-900">0h</p>
                        </div>
                        <div class="progress-bar-bg h-2 rounded-full overflow-hidden">
                            <div class="progress-bar-fill h-full rounded-full" style="width: 0%;"></div>
                        </div>
                    `;
                    container.appendChild(div);
                }
            });
        }
        function renderizarDashboard() {
            const metricas = calcularMetricas(registros);
            renderizarResumo(metricas);
            renderizarRegistros(registros);
            renderizarHorasPorObra(registros, metricas.totalHoras);
        }
        function showCustomModal(title, message, isAction = false, actionCallback = null) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            const modalActionBtn = document.getElementById('modalActionBtn');

            if (isAction && actionCallback) {
                modalActionBtn.textContent = 'Confirmar';
                modalActionBtn.classList.remove('hidden');
                modalActionBtn.onclick = () => {
                    actionCallback();
                    closeCustomModal();
                };
            } else {
                modalActionBtn.classList.add('hidden');
                modalActionBtn.onclick = null;
            }

            document.getElementById('customModal').classList.remove('hidden');
            document.getElementById('customModal').classList.add('flex');
        }
        function closeCustomModal() {
            document.getElementById('customModal').classList.add('hidden');
            document.getElementById('customModal').classList.remove('flex');
        }
        window.onload = renderizarDashboard;

    </script>
</body>
</html>